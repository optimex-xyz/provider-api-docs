# Trading API V2

## 1. Trade Quote/Execute

```http
POST /v2/trades/quote
```

**Request Body**

```json
{
  "from_token_id": string,          // Token to send (e.g., "BTC")
  "to_token_id": string,            // Token to receive (e.g., "ETH")
  "amount_in": string,              // Amount to send in smallest unit (previously from_token_amount)
  "slippage": string,               // Slippage tolerance in basis points (default: "100" for 1%)
  "affiliate_fee_bps": string,      // Affiliate fee in basis points (optional)
  "from_user_address": string,      // Required: The user's address from which the input token will be sent from (crosschain string)
  "to_user_address": string,        // Required: The user's address to which the output token will be sent to (crosschain string)
  "user_refund_pubkey": string,     // Required: The user's public key to which the refund will be sent (crosschain string)
  "trade_timeout": number,          // Optional, defaults to 2 hours
  "script_timeout": number,         // Optional, defaults to 24 hours
  "affiliate_info": [               // Optional affiliate information
    {
      "provider": string,      // Name of the affiliate provider
      "rate": string,          // Fee rate in basis points (e.g., "25" for 0.25%)
      "receiver": string,      // Provider address
      "network": string        // Optional: Network where affiliate fees will be paid
    }
  ]
}
```

### Response

**Response** `200`

```json
{
  "data": {
    "trade_id": string,          // Unique trade identifier
    "deposit_address": string,   // Address to send tokens to
    "payload": string,           // Only exists if trade from EVM
    "min_amount_out": string,        // Estimated amount out before fees
  }
}
```

### Parameters Description

| Parameter            | Type   | Required | Description                                         |
| -------------------- | ------ | -------- | --------------------------------------------------- |
| `from_token_id`      | string | Yes      | Token to send (e.g., "BTC", "ETH")                  |
| `to_token_id`        | string | Yes      | Token to receive (e.g., "ETH", "BTC")               |
| `amount_in`          | string | Yes      | Amount to send in smallest unit (bigint string)     |
| `slippage`           | string | No       | Slippage tolerance in basis points (default: "100") |
| `affiliate_fee_bps`  | string | No       | Affiliate fee in basis points                       |
| `from_user_address`  | string | Yes      | User's sending address (crosschain string)          |
| `to_user_address`    | string | Yes      | User's receiving address (crosschain string)        |
| `user_refund_pubkey` | string | Yes      | User's refund public key (crosschain string)        |
| `trade_timeout`      | number | No       | Trade timeout in seconds (default: 7200)            |
| `script_timeout`     | number | No       | Script timeout in seconds (default: 86400)          |
| `affiliate_info`     | array  | No       | Affiliate information array                         |

---

## 2. Submit Transaction

```http
POST /v2/trades/submit-tx
```

**Request Body**

```json
{
  "trade_id": string,  // Required: Unique trade identifier
  "tx_id": string      // Required: Transaction ID on asset chain
}
```

**Response** `200`

```json
{
  "data": {
    "msg": string  // Confirmation message
  }
}
```

---

## 3. Get Trade Detail

```http
GET /v2/trades/{trade_id}
```

**Response** `200`

```json
{
  "data": {
    "trade_id": string,
    "from_token_id": string,
    "to_token_id": string,
    "amount_in": string,
    "amount_out": string,
    "status": string,
    "created_at": string,
    "updated_at": string,
    "events": [
      {
        "event_type": string,
        "timestamp": string,
        "data": object
      }
    ]
    // Additional trade details and events
  }
}
```

---

## 4. List Trades

```http
GET /v2/trades
```

**Query Parameters**

| Parameter | Type   | Required | Description                              |
| --------- | ------ | -------- | ---------------------------------------- |
| `limit`   | number | No       | Number of trades to return (default: 20) |
| `offset`  | number | No       | Number of trades to skip (default: 0)    |
| `status`  | string | No       | Filter by trade status                   |

**Response** `200`

```json
{
  "data": {
    "trades": [
      {
        "trade_id": string,
        "from_token_id": string,
        "to_token_id": string,
        "amount_in": string,
        "amount_out": string,
        "status": string,
        "created_at": string,
        "updated_at": string
      }
    ],
    "total": number,
    "limit": number,
    "offset": number
  }
}
```
